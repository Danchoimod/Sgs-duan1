USE master;
ALTER DATABASE PolyCafe SET SINGLE_USER WITH ROLLBACK IMMEDIATE;
DROP DATABASE PolyCafe;

CREATE DATABASE PolyCafe;
GO

USE PolyCafe;
GO

-- 1. Bảng Categories
CREATE TABLE Categories
(
    Id NVARCHAR(20) NOT NULL PRIMARY KEY,
    Name NVARCHAR(50) NOT NULL
);

INSERT INTO Categories
    (Id, Name)
VALUES
    ('C01', N'Cà phê'),
    ('C02', N'Trà sữa'),
    ('C03', N'Nước ép'),
    ('C04', N'Sinh tố'),
    ('C05', N'Soda');

-- 2. Bảng Drinks
CREATE TABLE Drinks
(
    Id NVARCHAR(20) NOT NULL PRIMARY KEY,
    Name NVARCHAR(50) NOT NULL,
    UnitPrice FLOAT NOT NULL,
    Discount FLOAT NOT NULL,
    Image NVARCHAR(50) NOT NULL,
    Available BIT NOT NULL,
    CategoryId NVARCHAR(20) NOT NULL,
    FOREIGN KEY (CategoryId) REFERENCES Categories(Id)
        ON DELETE CASCADE
        ON UPDATE CASCADE
);

INSERT INTO Drinks
    (Id, Name, UnitPrice, Discount, Image, Available, CategoryId)
VALUES
    -- Cà phê
    ('D01', N'Cà phê đen', 20000, 5, 'ca_phe_den.jpg', 1, 'C01'),
    ('D02', N'Cà phê sữa', 25000, 0, 'ca_phe_sua.jpg', 1, 'C01'),
    ('D03', N'Bạc xỉu', 27000, 0, 'bac_xiu.jpg', 1, 'C01'),
    ('D04', N'Cà phê cốt dừa', 35000, 7, 'ca_phe_cot_dua.jpg', 1, 'C01'),
    ('D05', N'Latte', 40000, 0, 'latte.jpg', 1, 'C01'),
    ('D06', N'Cappuccino', 40000, 10, 'cappuccino.jpg', 1, 'C01'),

    -- Trà sữa
    ('D07', N'Trà sữa truyền thống', 30000, 10, 'tra_sua_truyen_thong.jpg', 1, 'C02'),
    ('D08', N'Trà sữa matcha', 32000, 5, 'tra_sua_matcha.jpg', 1, 'C02'),
    ('D09', N'Trà sữa socola', 32000, 5, 'tra_sua_socola.jpg', 1, 'C02'),
    ('D10', N'Trà sữa thái xanh', 33000, 0, 'tra_sua_thai_xanh.jpg', 1, 'C02'),
    ('D11', N'Trà sữa trân châu đường đen', 35000, 5, 'tra_sua_duong_den.jpg', 1, 'C02'),
    ('D12', N'Trà sữa khoai môn', 33000, 0, 'tra_sua_khoai_mon.jpg', 1, 'C02'),

    -- Nước ép
    ('D13', N'Nước cam ép', 28000, 10, 'nuoc_cam_ep.jpg', 1, 'C03'),
    ('D14', N'Nước ép táo', 30000, 0, 'nuoc_ep_tao.jpg', 1, 'C03'),
    ('D15', N'Nước ép dứa', 30000, 5, 'nuoc_ep_dua.jpg', 1, 'C03'),
    ('D16', N'Nước ép ổi', 30000, 0, 'nuoc_ep_oi.jpg', 1, 'C03'),
    ('D17', N'Nước ép cà rốt', 32000, 5, 'nuoc_ep_ca_rot.jpg', 1, 'C03'),
    ('D18', N'Nước ép lựu', 35000, 0, 'nuoc_ep_luu.jpg', 1, 'C03'),

    -- Sinh tố
    ('D19', N'Sinh tố xoài', 32000, 10, 'sinh_to_xoai.jpg', 1, 'C04'),
    ('D20', N'Sinh tố bơ', 33000, 20, 'sinh_to_bo.jpg', 1, 'C04'),
    ('D21', N'Sinh tố dâu', 33000, 0, 'sinh_to_dau.jpg', 1, 'C04'),
    ('D22', N'Sinh tố mãng cầu', 34000, 0, 'sinh_to_mang_cau.jpg', 1, 'C04'),
    ('D23', N'Sinh tố chuối', 32000, 10, 'sinh_to_chuoi.jpg', 1, 'C04'),
    ('D24', N'Sinh tố sapoche', 33000, 0, 'sinh_to_sapoche.jpg', 1, 'C04'),

    -- Soda
    ('D25', N'Soda chanh', 30000, 0, 'soda_chanh.jpg', 1, 'C05'),
    ('D26', N'Soda dâu', 30000, 15, 'soda_dau.jpg', 1, 'C05'),
    ('D27', N'Soda việt quất', 32000, 0, 'soda_viet_quat.jpg', 1, 'C05'),
    ('D28', N'Soda cam', 32000, 0, 'soda_cam.jpg', 1, 'C05'),
    ('D29', N'Soda bạc hà', 32000, 10, 'soda_bac_ha.jpg', 1, 'C05'),
    ('D30', N'Soda kiwi', 33000, 5, 'soda_kiwi.jpg', 1, 'C05');

-- 3. Bảng Cards
CREATE TABLE Cards
(
    Id INT NOT NULL PRIMARY KEY,
    Status INT NOT NULL
);
INSERT INTO Cards
    (Id, Status)
VALUES
    (101, 1),
    (102, 0),
    (103, 1),
    (104, 1),
    (105, 1),
    (106, 1),
    (107, 0),
    (108, 1),
    (109, 0),
    (110, 1),
    (111, 1),
    (112, 1),
    (113, 1),
    (114, 1),
    (115, 1),
    (116, 0),
    (117, 1),
    (118, 0),
    (119, 1),
    (120, 1);

-- 4. Bảng Users
CREATE TABLE Users
(
    Username NVARCHAR(20) NOT NULL PRIMARY KEY,
    Password NVARCHAR(50) NOT NULL,
    Enabled BIT NOT NULL,
    Fullname NVARCHAR(50) NOT NULL,
    Photo NVARCHAR(50) NOT NULL,
    Manager BIT NOT NULL
);

INSERT INTO Users
    (Username, Password, Enabled, Fullname, Photo, Manager)
VALUES
    ('admin', 'admin123', 1, N'Nguyễn Văn A', 'admin.jpg', 1),
    ('minh', 'minh123', 1, N'Trần Thị B', 'minh.jpg', 0),
    ('linh', 'linh123', 1, N'Lê Văn C', 'linh.jpg', 0),
    ('dung', 'dung123', 1, N'Phạm Thị D', 'dung.jpg', 0),
    ('huy', 'huy123', 1, N'Hồ Văn E', 'huy.jpg', 0),
    ('cao', 'cao123', 1, N'Nguyễn Văn Cao', 'cao.jpg', 0),
    ('thao', 'thao123', 1, N'Phạm Thị Thảo', 'thao.jpg', 0),
    ('lan', 'lan123', 1, N'Trần Thị Lan', 'lan.jpg', 0);

-- 5. Bảng Bills
CREATE TABLE Bills
(
    Id BIGINT NOT NULL IDENTITY(10000, 1) PRIMARY KEY,
    Username NVARCHAR(20) NOT NULL,
    CardId INT NOT NULL,
    Checkin DATETIME NOT NULL,
    Checkout DATETIME NULL,
    Status INT NOT NULL,
    FOREIGN KEY(Username) 
    REFERENCES Users(Username)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
    FOREIGN KEY (CardId) REFERENCES Cards(Id)
    ON DELETE CASCADE
    ON UPDATE CASCADE
);
INSERT INTO Bills
    (Username, CardId, Checkin, Checkout, Status)
VALUES
    ('admin', 101, '2025-06-10 07:30:00', '2025-06-10 08:15:00', 1),
    ('minh', 103, '2025-06-10 08:00:00', '2025-06-10 08:45:00', 1),
    ('linh', 105, '2025-06-10 08:30:00', '2025-06-10 09:00:00', 1),
    ('dung', 107, '2025-06-10 09:15:00', '2025-06-10 10:00:00', 1),
    ('huy', 102, '2025-06-10 09:45:00', NULL, 2),
    ('cao', 104, '2025-06-10 10:30:00', '2025-06-10 11:15:00', 1),
    ('thao', 106, '2025-06-07 11:00:00', '2025-06-07 11:30:00', 1),
    ('lan', 101, '2025-06-06 11:45:00', '2025-06-06 12:30:00', 1),
    ('admin', 108, '2025-06-05 12:15:00', NULL, 0),
    ('minh', 103, '2025-06-04 13:00:00', '2025-06-04 13:45:00', 1),
    ('linh', 109, '2025-06-03 14:30:00', '2025-06-03 15:15:00', 1),
    ('dung', 105, '2025-06-02 15:00:00', NULL, 0),
    ('huy', 110, '2025-06-02 16:15:00', '2025-06-02 17:00:00', 1),
    ('cao', 102, '2025-06-02 17:30:00', NULL, 0),
    ('thao', 107, '2025-06-02 18:00:00', '2025-06-02 18:45:00', 1),
    ('lan', 104, '2025-06-01 08:00:00', '2025-06-01 08:30:00', 1),
    ('admin', 111, '2025-05-31 09:15:00', '2025-05-31 10:00:00', 1),
    ('minh', 106, '2025-05-30 10:30:00', NULL, 2),
    ('linh', 112, '2025-05-29 11:45:00', '2025-05-29 12:30:00', 1),
    ('dung', 108, '2025-05-28 13:00:00', '2025-05-28 13:45:00', 1),
    ('huy', 113, '2025-05-27 14:15:00', '2025-05-27 15:00:00', 1),
    ('cao', 109, '2025-05-26 15:30:00', '2025-05-26 16:15:00', 1),
    ('thao', 114, '2025-05-25 16:45:00', '2025-05-25 17:30:00', 1),
    ('lan', 110, '2025-05-24 17:45:00', '2025-05-24 18:30:00', 1),
    ('admin', 115, '2025-05-23 18:00:00', '2025-05-23 18:45:00', 1),
    ('minh', 111, '2025-05-22 19:00:00', '2025-05-22 19:30:00', 1),
    ('linh', 116, '2025-05-21 19:15:00', '2025-05-21 20:00:00', 1),
    ('dung', 117, '2025-04-30 07:45:00', '2025-04-30 08:30:00', 1),
    ('huy', 112, '2025-04-29 09:00:00', '2025-04-29 09:45:00', 1),
    ('cao', 118, '2025-04-28 10:15:00', '2025-04-28 11:00:00', 1),
    ('thao', 113, '2025-04-27 11:30:00', NULL, 2),
    ('lan', 119, '2025-04-26 13:00:00', '2025-04-26 13:45:00', 1),
    ('admin', 114, '2025-04-25 08:30:00', '2025-04-25 09:15:00', 1),
    ('minh', 120, '2025-04-24 10:00:00', '2025-04-24 10:45:00', 1),
    ('linh', 115, '2025-04-23 11:15:00', '2025-04-23 12:00:00', 1),
    ('dung', 117, '2025-04-22 13:30:00', '2025-04-22 14:15:00', 1),
    ('huy', 116, '2025-04-21 15:00:00', '2025-04-21 15:45:00', 1),
    ('cao', 118, '2025-04-20 09:15:00', '2025-04-20 10:00:00', 1),
    ('thao', 119, '2025-04-19 10:30:00', '2025-04-19 11:15:00', 1),
    ('lan', 120, '2025-04-18 12:00:00', '2025-04-18 12:45:00', 1),
    ('admin', 117, '2025-04-17 14:15:00', NULL, 2),
    ('minh', 112, '2025-04-16 16:30:00', '2025-04-16 17:15:00', 1),
    ('linh', 114, '2025-03-31 08:00:00', '2025-03-31 08:45:00', 1),
    ('dung', 115, '2025-03-30 10:30:00', '2025-03-30 11:15:00', 1),
    ('huy', 116, '2025-03-29 13:00:00', '2025-03-29 13:45:00', 1),
    ('cao', 118, '2025-03-28 15:15:00', '2025-03-28 16:00:00', 1),
    ('thao', 119, '2025-03-27 17:30:00', '2025-03-27 18:15:00', 1),
    ('lan', 120, '2025-03-26 09:00:00', '2025-03-26 09:45:00', 1),
    ('admin', 117, '2025-03-25 11:15:00', '2025-03-25 12:00:00', 1),
    ('minh', 112, '2025-03-24 14:30:00', '2025-03-24 15:15:00', 1),
    ('linh', 113, '2025-03-23 16:00:00', NULL, 2),
    ('dung', 114, '2025-03-22 18:15:00', '2025-03-22 19:00:00', 1),
    ('huy', 115, '2025-02-28 08:30:00', '2025-02-28 09:15:00', 1),
    ('cao', 116, '2025-02-27 10:45:00', '2025-02-27 11:30:00', 1),
    ('thao', 117, '2025-02-26 13:00:00', '2025-02-26 13:45:00', 1),
    ('lan', 118, '2025-02-25 15:15:00', '2025-02-25 16:00:00', 1),
    ('admin', 119, '2025-02-24 17:30:00', '2025-02-24 18:15:00', 1),
    ('minh', 120, '2025-02-23 07:45:00', '2025-02-23 08:30:00', 1),
    ('linh', 112, '2025-02-22 09:00:00', '2025-02-22 09:45:00', 1),
    ('dung', 113, '2025-02-21 11:15:00', NULL, 2),
    ('huy', 114, '2025-02-20 13:30:00', '2025-02-20 14:15:00', 1),
    ('cao', 115, '2025-02-19 15:45:00', '2025-02-19 16:30:00', 1),
    ('thao', 116, '2025-01-31 08:15:00', '2025-01-31 09:00:00', 1),
    ('lan', 117, '2025-01-30 10:30:00', '2025-01-30 11:15:00', 1),
    ('admin', 118, '2025-01-29 12:45:00', '2025-01-29 13:30:00', 1),
    ('minh', 119, '2025-01-28 14:00:00', '2025-01-28 14:45:00', 1),
    ('linh', 120, '2025-01-27 16:15:00', '2025-01-27 17:00:00', 1),
    ('dung', 112, '2024-12-31 09:30:00', '2024-12-31 10:15:00', 1),
    ('huy', 113, '2024-12-30 11:00:00', '2024-12-30 11:45:00', 1),
    ('cao', 114, '2024-12-29 13:15:00', '2024-12-29 14:00:00', 1),
    ('thao', 115, '2024-12-28 15:30:00', NULL, 2),
    ('lan', 116, '2024-12-27 17:00:00', '2024-12-27 17:45:00', 1),
    ('admin', 117, '2024-11-30 08:00:00', '2024-11-30 08:45:00', 1),
    ('minh', 118, '2024-11-29 10:15:00', '2024-11-29 11:00:00', 1),
    ('linh', 119, '2024-11-28 12:30:00', '2024-11-28 13:15:00', 1),
    ('dung', 120, '2024-11-27 14:45:00', '2024-11-27 15:30:00', 1),
    ('huy', 112, '2024-11-26 16:00:00', '2024-11-26 16:45:00', 1),
    ('cao', 113, '2024-10-31 09:15:00', '2024-10-31 10:00:00', 1),
    ('thao', 114, '2024-10-30 11:30:00', '2024-10-30 12:15:00', 1),
    ('lan', 115, '2024-10-29 13:45:00', '2024-10-29 14:30:00', 1),
    ('admin', 116, '2024-10-28 15:00:00', NULL, 2),
    ('minh', 117, '2024-10-27 17:15:00', '2024-10-27 18:00:00', 1),
    ('linh', 118, '2024-09-30 08:30:00', '2024-09-30 09:15:00', 1),
    ('dung', 119, '2024-09-29 10:45:00', '2024-09-29 11:30:00', 1),
    ('huy', 120, '2024-09-28 13:00:00', '2024-09-28 13:45:00', 1),
    ('cao', 112, '2024-09-27 15:15:00', '2024-09-27 16:00:00', 1),
    ('thao', 113, '2024-09-26 17:30:00', '2024-09-26 18:15:00', 1),
    ('lan', 114, '2024-09-05 09:00:00', '2024-09-05 09:45:00', 1),
    ('admin', 115, '2024-09-05 11:15:00', '2024-09-05 12:00:00', 1),
    ('minh', 116, '2024-09-05 13:30:00', NULL, 2),
    ('linh', 117, '2024-09-05 15:45:00', '2024-09-05 16:30:00', 1),
    ('dung', 118, '2024-09-05 17:00:00', '2024-09-05 17:45:00', 1),
    ('huy', 119, '2024-08-24 10:00:00', '2024-08-24 10:45:00', 1),
    ('cao', 120, '2024-08-24 14:30:00', '2024-08-24 15:15:00', 1);

CREATE TABLE BillDetails
(
    Id BIGINT
        NOT NULL IDENTITY
    (100000, 1) PRIMARY KEY,
    BillId BIGINT NOT NULL,
    DrinkId NVARCHAR
    (20) NOT NULL,
    UnitPrice FLOAT NOT NULL,
    Discount FLOAT NOT NULL,
    Quantity INT NOT NULL,
    FOREIGN KEY
    (BillId) REFERENCES Bills
    (Id)
            ON
    DELETE CASCADE
            ON
    UPDATE CASCADE,
    FOREIGN KEY (DrinkId) REFERENCES Drinks(Id)
    ON
    DELETE CASCADE
            ON
    UPDATE CASCADE
);

INSERT INTO BillDetails
    (BillId, DrinkId, UnitPrice, Discount, Quantity)
VALUES
    (10000, 'D01', 20000, 0.05, 2),
    (10000, 'D07', 30000, 0.1, 1),
    (10004, 'D08', 32000, 0.05, 1), 
    (10004, 'D14', 30000, 0.0, 2),
    (10000, 'D13', 28000, 0.1, 1),
    (10001, 'D02', 25000, 0.0, 1),
    (10001, 'D08', 32000, 0.05, 2),
    (10002, 'D03', 27000, 0.0, 1),
    (10002, 'D09', 32000, 0.05, 1),
    (10002, 'D14', 30000, 0.0, 2),
    (10002, 'D25', 30000, 0.0, 1),
    (10003, 'D04', 35000, 0.07, 3),
    (10005, 'D05', 40000, 0.0, 1),
    (10005, 'D15', 30000, 0.05, 2),
    (10006, 'D06', 40000, 0.1, 1),
    (10006, 'D11', 35000, 0.05, 1),
    (10006, 'D26', 30000, 0.15, 2),
    (10007, 'D01', 20000, 0.05, 2),
    (10007, 'D07', 30000, 0.1, 1),
    (10009, 'D02', 25000, 0.0, 1),
    (10009, 'D08', 32000, 0.05, 1),
    (10009, 'D19', 32000, 0.1, 2),
    (10009, 'D25', 30000, 0.0, 1),
    (10010, 'D03', 27000, 0.0, 2),
    (10012, 'D04', 35000, 0.07, 1),
    (10012, 'D10', 33000, 0.0, 1),
    (10012, 'D16', 30000, 0.0, 2),
    (10012, 'D20', 33000, 0.2, 1),
    (10012, 'D29', 32000, 0.1, 1),
    (10014, 'D05', 40000, 0.0, 1),
    (10014, 'D12', 33000, 0.0, 2),
    (10014, 'D18', 35000, 0.0, 1),
    (10015, 'D06', 40000, 0.1, 1),
    (10015, 'D21', 33000, 0.0, 2),
    (10016, 'D01', 20000, 0.05, 3),
    (10018, 'D09', 32000, 0.05, 1),
    (10018, 'D14', 30000, 0.0, 1),
    (10018, 'D22', 34000, 0.0, 2),
    (10018, 'D27', 32000, 0.0, 1),
    (10019, 'D11', 35000, 0.05, 1),
    (10019, 'D24', 33000, 0.0, 2),
    (10020, 'D13', 28000, 0.1, 2),
    (10020, 'D17', 32000, 0.05, 1),
    (10020, 'D30', 33000, 0.05, 1),
    (10021, 'D02', 25000, 0.0, 4),
    (10022, 'D03', 27000, 0.0, 1),
    (10022, 'D08', 32000, 0.05, 1),
    (10022, 'D15', 30000, 0.05, 2),
    (10022, 'D19', 32000, 0.1, 1),
    (10022, 'D28', 32000, 0.0, 1),
    (10024, 'D04', 35000, 0.07, 2),
    (10024, 'D23', 32000, 0.1, 1),
    (10025, 'D05', 40000, 0.0, 1),
    (10025, 'D10', 33000, 0.0, 2),
    (10025, 'D26', 30000, 0.15, 1),
    (10026, 'D01', 20000, 0.05, 2),
    (10027, 'D07', 30000, 0.1, 1),
    (10027, 'D12', 33000, 0.0, 1),
    (10027, 'D18', 35000, 0.0, 2),
    (10027, 'D25', 30000, 0.0, 1),
    (10029, 'D06', 40000, 0.1, 1),
    (10029, 'D16', 30000, 0.0, 3),
    (10030, 'D09', 32000, 0.05, 2),
    (10030, 'D20', 33000, 0.2, 1),
    (10031, 'D11', 35000, 0.05, 1),
    (10031, 'D27', 32000, 0.0, 2),
    (10031, 'D03', 27000, 0.0, 1),
    (10032, 'D14', 30000, 0.0, 3),
    (10032, 'D29', 32000, 0.1, 1),
    (10034, 'D17', 32000, 0.05, 1),
    (10034, 'D21', 33000, 0.0, 2),
    (10034, 'D08', 32000, 0.05, 1),
    (10035, 'D01', 20000, 0.05, 2),
    (10035, 'D13', 28000, 0.1, 1),
    (10036, 'D02', 25000, 0.0, 3),
    (10036, 'D19', 32000, 0.1, 1),
    (10037, 'D04', 35000, 0.07, 1),
    (10037, 'D24', 33000, 0.0, 2),
    (10039, 'D05', 40000, 0.0, 1),
    (10039, 'D15', 30000, 0.05, 1),
    (10005, 'D01', 20000, 0.05, 1),
    (10005, 'D07', 30000, 0.10, 2),
    (10013, 'D02', 25000, 0.00, 1),
    (10013, 'D08', 32000, 0.05, 1),
    (10018, 'D03', 27000, 0.00, 2),
    (10018, 'D09', 32000, 0.05, 1),
    (10028, 'D04', 35000, 0.07, 1),
    (10028, 'D10', 33000, 0.00, 2),
    (10038, 'D05', 40000, 0.00, 1),
    (10038, 'D11', 35000, 0.05, 1),
    (10048, 'D06', 40000, 0.10, 2),
    (10039, 'D28', 32000, 0.0, 2),
    (10008, 'D01', 20000, 0.05, 1),
    (10008, 'D07', 30000, 0.10, 2),
    (10011, 'D13', 28000, 0.10, 1),
    (10011, 'D19', 32000, 0.10, 1),
    (10013, 'D02', 25000, 0.00, 1),
    (10013, 'D08', 32000, 0.05, 1); 

ALTER TABLE Drinks
ADD CONSTRAINT chk_unitprice CHECK (UnitPrice >= 0);

ALTER TABLE Drinks
ADD CONSTRAINT chk_discount CHECK (Discount >= 0 AND Discount <= 100);

ALTER TABLE BillDetails
DROP CONSTRAINT chk_billdetails_discount;

ALTER TABLE BillDetails
ADD CONSTRAINT chk_billdetails_discount CHECK (Discount >= 0 AND Discount <= 100);
